# Метрики, мониторинг и обратная связь

Цель: выполнить QAP пункты про (1) количественные метрики, (2) ключевую метрику надежности и инструмент мониторинга, (3) сбор feedback (CSI/NPS) с периодическим prompt.

## 1. Ключевые метрики (KPI/SLI)

### 1.1. Надежность (ключевая контролируемая метрика)

Выбрать 1 «ключевую» (для self-check) и 2–3 вспомогательных:

- Key metric (пример): **Crash‑free sessions (%)** для iOS клиента.
- Вспомогательные:
  - API error rate (5xx/4xx) по endpoint’ам.
  - p95 latency по ключевым запросам (list/details).
  - Доля успешных завершений ключевого сценария (success rate UC‑05).

Инструменты мониторинга (примерный набор):

- Для клиента: Sentry или Firebase Crashlytics (crashes, non‑fatal errors).
- Для backend/инфры: Prometheus + Grafana (метрики), Loki/ELK (логи), OpenTelemetry (трейсы).
- Альтернатива/дополнение: Zabbix для инфраструктурных метрик и алертов.

### 1.2. Производительность

- Cold start p50/p95.
- Время загрузки экрана списка/деталей (p50/p95).
- Размер ответов API и объем трафика за сессию.

### 1.3. UX/продукт

- Retention D1/D7 (если есть аналитика).
- Session length.
- Конверсия в «успешное завершение сценария».
- CSI/NPS по сценариям.

## 2. Дашборды и алерты (минимум)

- Dashboard‑1: API health — RPS, error rate, p95 latency.
- Dashboard‑2: DB health — connections, slow queries (если доступно).
- Dashboard‑3: Mobile stability — crash‑free sessions, топ ошибок.

Алерты (пример):

- Error rate > T% за 5 минут.
- p95 latency > X ms за 10 минут.
- Crash‑free sessions < Y% за сутки.

## 3. Сбор обратной связи (CSI/NPS)

### 3.1. Каналы

- Кнопка «Обратная связь» (минимум для 1 балла).
- Периодический prompt (для 2 баллов): показывать после завершения ключевого сценария.

### 3.2. Правила показа prompt (рекомендации)

- Не чаще 1 раза в N дней (rate‑limit).
- Не показывать, если пользователь уже ответил в текущем релизе.
- Не показывать, если в текущей сессии был crash/критическая ошибка (избежать раздражения).

### 3.3. Что сохранять (privacy-friendly)

- Оценка (NPS 0–10 или CSI 1–5), опциональный комментарий.
- Контекст: версия приложения, OS, экран/сценарий, timestamp.
- Не сохранять PII без необходимости.

## 4. Процесс улучшений (замкнутый цикл)

1) Собрать метрики/feedback → 2) Найти топ‑проблемы → 3) Завести задачи → 4) Исправить → 5) Повторно измерить.

Артефакты для защиты/оценки:

- Скриншоты дашбордов (Grafana/Crash tool).
- Пример алерта и его разбор.
- Короткий отчет «до/после» по 1–2 метрикам.

